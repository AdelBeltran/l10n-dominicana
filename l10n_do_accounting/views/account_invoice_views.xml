<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="l10n_do_accounting_invoice_form" model="ir.ui.view">
        <field name="name">l10n.do.accounting.invoice.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='has_outstanding']" position="after">
                <field name="fiscal_sequence_status" invisible="1"/>
            </xpath>
            <xpath expr="/form/div[hasclass('alert')]" position="after">
                <div groups="account.group_account_invoice" class="alert alert-warning" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('fiscal_sequence_status','in', ('no_fiscal', 'fiscal_ok', 'no_sequence')), ('state', 'not in', ('draft', 'open'))]}">
                    Fiscal Sequence almost depleted.
                </div>
                <div groups="account.group_account_invoice" class="alert alert-danger" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('fiscal_sequence_status','in', ('no_fiscal', 'fiscal_ok', 'almost_no_sequence')), ('state', 'not in', ('draft', 'open'))]}">
                    Fiscal Sequence depleted.
                </div>
            </xpath>
            <xpath expr="//button[@name='%(account.action_account_invoice_refund)d']" position="attributes">
                <attribute name="groups">l10n_do_accounting.credit_note_group</attribute>
            </xpath>
            <!--<xpath expr="//h1[@class='mt0']" position="before">-->
                <!--<h1 class="mt0">-->
                    <!--<field name="reference" -->
                           <!--string="NCF"-->
                           <!--readonly="1"-->
                           <!--attrs="{-->
                           <!--'invisible': ['|', '|', ('state', '=', 'draft'), ('reference', '=', False), ('is_fiscal_invoice','=',False)],-->
                           <!--'readonly': True}"/>-->
                           <!--class="oe_inline" -->
                           <!--readonly="True"/>-->
                    <!--<field name="ncf_expiration_date" class="oe_right" readonly="True"-->
                           <!--attrs="{'invisible' : ['|',('state', 'in', ('draft','cancel'))]}"/>-->
                <!--</h1>-->
            <!--</xpath>-->
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="is_fiscal_invoice"
                       invisible="1"/>
                <field name="fiscal_type_id"
                       attrs="{
                       'invisible':['|',('type','=','out_refund'),('is_fiscal_invoice','=',False)],
                       'required': [('is_fiscal_invoice','=',True),('type','=','out_invoice')],
                       'readonly': ['|',('state','!=','draft'),('reference','!=',False)]}"
                       domain="[('type', '=', 'out_invoice')]"/>
                <field name="fiscal_sequence_id"
                       invisible="1"/>
                <field name="income_type"
                       attrs="{
                       'invisible':[('is_fiscal_invoice','!=',True)],
                       'required': [('is_fiscal_invoice','=',True),('type','=','out_invoice')],
                       'readonly': [('state','!=','draft')]}"/>
                <field name="reference"
                       string="NCF"
                       readonly="1"
                       attrs="{
                       'invisible': ['|', '|', ('state', '=', 'draft'), ('reference', '=', False), ('is_fiscal_invoice','=',False)],
                       'readonly': True}"/>
                <field name="origin_out"
                       groups="base.group_user"
                       attrs="{
                       'invisible': [('type', '!=', 'out_refund')],
                       'readonly': [('state', '!=', 'draft')]}"/>
            </xpath>

            <xpath expr="//form[1]/sheet[1]/notebook[1]/page[@name='other_info']/group[1]/group[1]/field[@name='reference']" position="replace"/>


        </field>
    </record>

    <record id="l10n_do_accounting_invoice_supplier_form" model="ir.ui.view">
        <field name="name">l10n.do.accounting.invoice.supplier.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='has_outstanding']" position="after">
                <field name="fiscal_sequence_status" invisible="1"/>
            </xpath>
            <xpath expr="/form/div[hasclass('alert')]" position="after">
                <div groups="account.group_account_invoice" class="alert alert-warning" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('fiscal_sequence_status','in', ('no_fiscal', 'fiscal_ok', 'no_sequence')), ('state', 'not in', ('draft', 'open'))]}">
                    Fiscal Sequence almost depleted.
                </div>
                <div groups="account.group_account_invoice" class="alert alert-danger" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('fiscal_sequence_status','in', ('no_fiscal', 'fiscal_ok', 'almost_no_sequence')), ('state', 'not in', ('draft', 'open'))]}">
                    Fiscal Sequence depleted.
                </div>
            </xpath>
            <xpath expr="//button[@name='%(account.action_account_invoice_refund)d']" position="attributes">
                <attribute name="groups">l10n_do_accounting.credit_note_group</attribute>
            </xpath>

            <!--<xpath expr="//sheet/div/h1[@class='mt0']" position="before">-->
                <!--<h1 class="mt0">-->
                    <!--<field name="name" class="oe_inline"-->
                           <!--attrs="{'invisible' : [('purchase_type', '=', 'others')], 'readonly' : ['|',('state', '!=', 'draft'),('purchase_type','!=','normal')], 'required' : [('purchase_type', '=', 'normal')]}"/>-->
                    <!--&lt;!&ndash;<field name="ncf_expiration_date" class="oe_right"&ndash;&gt;-->
                           <!--&lt;!&ndash;attrs="{'invisible' : ['|',('purchase_type', '=', 'others'), ('ncf_remote_validation', '=', True), ('state', '=', 'draft')], 'readonly' : ['|',('state', '!=', 'draft'),('purchase_type','!=','normal')], 'required' : [('purchase_type', '=', 'normal'), ('ncf_remote_validation', '=', False)]}"/>&ndash;&gt;-->
                <!--</h1>-->
            <!--</xpath>-->


            <field name="name" class="oe_inline"
                   attrs="{
                   'invisible' : [('purchase_type', '=', 'others')],
                   'readonly' : ['|',('state', '!=', 'draft'),('purchase_type','!=','normal')],
                   'required' : [('purchase_type', '=', 'normal')]}"/>

            <xpath expr="//field[@name='reference']" position="attributes">
                <attribute name="string">NCF</attribute>
                <attribute name="attrs">{
                    'invisible': ['|', ('is_fiscal_invoice', '=', False), ('fiscal_type_id', '=', False)],
                    'required': [('is_fiscal_invoice', '=', True), ('internal_generate', '=', False)],
                    'readonly': ['|',('state', '!=', 'draft'),('internal_generate','=', True)]}
                </attribute>
            </xpath>

            <!--<field name="journal_id" position="replace"/>-->
            <xpath expr="//field[@name='reference']" position="before">
                <field name="is_fiscal_invoice"
                       invisible="1"/>
                <field name="internal_generate"
                       invisible="1"/>
                <field name="fiscal_sequence_id"
                       invisible="1"/>
                <!--<field name="journal_id" groups="account.group_account_user"-->
                       <!--options="{'no_create': True, 'no_open': True}"-->
                       <!--attrs="{'readonly':[('state', '!=', 'draft')]}"/>-->
                <field name="fiscal_type_id"
                       attrs="{
                       'invisible':[('is_fiscal_invoice','=',False)],
                       'required': [('is_fiscal_invoice','=',True),('type','=','in_invoice')],
                       'readonly': [('state','!=','draft')]}"
                       domain="[('type', '=', 'in_invoice')]"/>
                <field name="expense_type" attrs="{
                       'invisible':[('is_fiscal_invoice', '=', False)],
                       'required': [('is_fiscal_invoice', '=', True)],
                       'readonly': [('state', '!=', 'draft')]}"/>
            </xpath>

            <xpath expr="//field[@name='reference']" position="after">
                <field name="origin_out"
                       groups="base.group_user"
                       attrs="{
                            'invisible': ['|', ('type', '!=', 'in_refund'), ('is_fiscal_invoice', '=', False)],
                            'readonly': [('state', '!=', 'draft')],
                            'required': [('type', '=', 'in_refund'), ('is_fiscal_invoice', '=', True)]}"/>
            </xpath>


        </field>
    </record>

    <menuitem id="account.menu_action_invoice_out_refund"
              groups="l10n_do_accounting.credit_note_group"
    />

    <menuitem id="account.menu_action_invoice_in_refund"
              groups="l10n_do_accounting.credit_note_group"
    />

</odoo>
